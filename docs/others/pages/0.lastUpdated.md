---
sidebar: false
tags:
  - Vuepress
  - Github Action
---

# lastUpdated

<page-tags slot-key="top" />

## 问题描述

在使用 Github Action 自动部署 Vuepress 时，配置`last-updated`总是出现问题，记录问题修复过程。

## 问题一 - 时间格式

初始的`last-updated`时间格式对于我来说看起来不是很适应，所以使用[dayjs](https://www.npmjs.com/package/dayjs)进行格式化。

::: tip 注意
如果你同样使用 Github Action 自动部署，需要注意修改`dayjs`的时区
:::

```js
// .vuepress/config.js

dayjs.extend(utc);
dayjs.extend(timezone);

module.exports = {
  // ...
  plugins: [
    '@vuepress/last-updated',
    {
      transformer: timestamp => {
        return dayjs(timestamp).tz('Asia/Shanghai').format('YYYY-MM-DD HH:mm:ss');
      }
    }
  ]
};
```

## 问题二 - 时间不符合预期

在本地开发环境中，各页面的`last-updated`展示都很正常，但是使用 Github Action 自动部署后，不仅本次修改页面的`last-updated`发生了改变，而且没有修改的页面也变成了最后提交时间，与`@vuepress/last-updated`插件描述的结果不一致。

起初我以为是`@vuepress/last-updated`插件出现问题，但是查找 Github 并没有相关 issue。经过一些列检查，最终发现是我的部署文件(deploy.yml)存在问题。

我的自动部署使用了`actions/checkout`，而其获取的提交查询深度(`fetch-depth`)默认是`1`，这导致`@vuepress/last-updated`插件获取页面时间戳时，总是最后的提交时间，继而导致了该问题的发生。

按照[官网](https://github.com/marketplace/actions/checkout?version=v2.4.2)的提示，只需要将`fetch-depth`改为`0`，拉取主分支所有提交历史即可。
