---
sidebar: auto
tags:
  - Vue
---

# VueDemi

<page-tags slot-key="top" />

## 介绍

[Vue Demi](https://github.com/vueuse/vue-demi)是一个开发工具，允许您为`Vue 2`和`Vue 3`编写通用 Vue 库。无需担心用户安装的版本。

当你要创建一个 Vue 插件/库，只需安装`vue-demi`作为你的依赖，并从它导入任何与 Vue 相关的东西。像往常一样发布你的插件/库，你的包就会变得通用!

在底层，它利用了[postinstall](https://docs.npmjs.com/misc/scripts) npm 钩子。安装所有包后，脚本将开始检查已安装的 Vue 版本，并将根据本地 Vue 版本导出重定向。当使用 Vue 2 时，如果没有安装`@vue/composition-api`，它也会自动安装。

更多信息请查看[Make Libraries Working with Vue 2 and 3](https://antfu.me/posts/make-libraries-working-with-vue-2-and-3)

## 使用

安装`vue-demi`作为插件依赖

```shell
npm i vue-demi
# or
yarn add vue-demi
```

将`vue`和`@vue/composition-api`添加到插件的同级依赖中，以指定支持哪些版本。

```json
{
  "dependencies": {
    "vue-demi": "latest"
  },
  "peerDependencies": {
    "@vue/composition-api": "^1.0.0-rc.1",
    "vue": "^2.0.0 || >=3.0.0"
  },
  "peerDependenciesMeta": {
    "@vue/composition-api": {
      "optional": true
    }
  },
  "devDependencies": {
    "vue": "^3.0.0" // or "^2.6.0" base on your preferred working environment
  }
}
```

从它导入所有与 Vue 相关的东西，它会根据用户的环境重定向到`vue@2` + `@vue/composition-api`或`vue@3`。

```js
import { ref, reactive, defineComponent } from 'vue-demi';
```

发布你的插件，一切就完成了!

::: warning
当与[Vite](https://vitejs.dev/)一起使用时，您需要选择退出预绑定，以使`vue-demi`正常工作

```js
// vite.config.js
export default defineConfig({
  optimizeDeps: {
    exclude: ['vue-demi']
  }
});
```

:::

## 额外的 API

`Vue Demi`提供了额外的 api 来帮助区分用户的环境，并执行一些特定于版本的逻辑。

### `isVue2` `isVue3`

```js
import { isVue2, isVue3 } from 'vue-demi';

if (isVue2) {
  // Vue 2 only
} else {
  // Vue 3 only
}
```

### `Vue2`

为了避免引入所有可摇树的模块，我们提供了一个 Vue2 导出来支持访问 Vue2 的全局 API。(见[#41](https://github.com/vueuse/vue-demi/issues/41)。)

```js
import { Vue2 } from 'vue-demi';

if (Vue2) {
  Vue2.config.ignoredElements.push('x-foo');
}
```

### `install`

Vue 2 中的 Composition API 是作为插件提供的，使用前需要安装在 Vue 实例上。通常，`vue-demi`会尝试自动安装它。对于某些用法，你可能需要确保插件被正确安装，`install()` API 作为`Vue.use(compostionapi)`的安全版本公开。Vue 3 环境中的`install()`将是一个空函数(no-op)。

```js
import { install } from 'vue-demi';

install();
```
